---
title: 传统型光栅化
description: 传统型光栅化将某些颇有自信地添加到像素呈现，冲突检测算法尤其是有帮助。
ms.assetid: 081199AD-1702-4EC8-95AD-B1148C676199
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fb4626fc6c48066d12da6ac93676ef7c9e5252d1
ms.sourcegitcommit: 1fbe7572f20938331e9c9bd6cccd098fa1c6054d
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/27/2019
ms.locfileid: "66224362"
---
# <a name="conservative-rasterization"></a>传统型光栅化

传统型光栅化将某些颇有自信地添加到像素呈现，冲突检测算法尤其是有帮助。

-   [概述](#overview)
-   [与管道之间的交互](#interactions-with-the-pipeline)
    -   [光栅化规则的交互](#rasterization-rules-interaction)
    -   [多级取样交互](#multisampling-interaction)
    -   [SampleMask 交互](#samplemask-interaction)
    -   [深度/模具测试交互](#depthstencil-test-interaction)
    -   [帮助器像素交互](#helper-pixel-interaction)
    -   [输出覆盖率交互](#output-coverage-interaction)
    -   [InputCoverage 交互](#inputcoverage-interaction)
    -   [InnerCoverage 交互](#innercoverage-interaction)
    -   [属性内插交互](#attribute-interpolation-interaction)
    -   [剪辑交互](#clipping-interaction)
    -   [剪辑距离交互](#clip-distance-interaction)
    -   [目标独立光栅化交互](#target-independent-rasterization-interaction)
    -   [IA 原型拓扑交互](#ia-primitive-topology-interaction)
    -   [查询交互](#query-interaction)
    -   [剔除状态交互](#cull-state-interaction)
    -   [IsFrontFace 交互](#isfrontface-interaction)
    -   [填充模式交互](#fill-modes-interaction)
-   [实现详细信息](#implementation-details)
-   [API 摘要](#api-summary)
-   [相关的主题](#related-topics)

## <a name="overview"></a>概述

传统型光栅化意味着至少部分覆盖的呈现基元的所有像素都进行光栅化，这意味着，调用像素着色器。 为采样正常行为，并不使用如果启用保守光栅化。

传统型光栅化可在许多情况下，包括用于颇有自信地碰撞检测、 封闭剔除，和呈现中。

例如下, 图显示了呈现使用保守光栅化，就像在光栅化程序 （即使用 16.8 固定的顶点坐标） 中显示一个绿色三角形。 褐色的区域称为"不确定性区域"-表示扩展的三角形，需确保在光栅化基元是相对于原始的浮动点顶点坐标保守的边界的概念性区域。 在每个顶点的红色正方形显示了如何计算的不确定性区域： 为扫描方框。

大型的灰色方块显示将呈现的像素。 粉红色方块显示使用"左上方规则"，其中发挥作用，如三角形的边跨越像素的边缘呈现的像素为单位。 可能存在误报 （不应该被的像素为单位设置） 的系统将正常但并不总是选择数据。

![最上面的左侧的规则](images/conservative-rasterization-0.png)

## <a name="interactions-with-the-pipeline"></a>与管道之间的交互

### <a name="rasterization-rules-interaction"></a>光栅化规则的交互

在保守光栅化模式下，光栅化规则保守光栅化模式下未启用的左上方规则，上文所述和像素覆盖率发生异常时应用方式相同。 16.8 必须使用定点光栅器精度。

如果它们是在没有更大的不确定性区域内固定的点域中的一半的像素，则仅可以包含将不包含一些如果硬件使用的完整的浮动点顶点坐标的像素为单位。 将来的硬件应达到指定第 2 层中的增强的不确定性区域。 请注意，此要求防止银三角形比实际需要进一步扩展。

类似有效的不确定性区域适用于`InnerCoverage`如由于没有实现这种情况下需要更大的不确定性区域，嗯，但它是更紧密。 请参阅[InnerCoverage 交互](#innercoverage-interaction)以了解详细信息。

内部和外部的不确定性区域必须是大于或等于半个亚像素网格或 1/512 个像素，固定的点域中的大小。 这是最小有效的不确定性区域。 1/512 来自 16.8 固定的点光栅器坐标显示和四舍五入到最近规则转换浮动点为 16.8 固定的点坐标的顶点坐标时适用。 如果光栅器精度发生更改，可以更改 1/512。 如果实现实现此最小的不确定性区域，它们必须的边缘或角部的不确定性区域不再处于沿边缘或角像素时，遵循左上方规则。 裁剪后的不确定性区域边缘应视为最接近的顶点，这意味着，计为两个边缘： 关联的顶点，参加这两个。 左上方规则使用的最小的不确定性区域是因为如果不是这样，保守光栅化实现会失败为保守光栅化模式下处于禁用状态时无法涵盖的光栅化像素时需要。

下图说明了通过扫描固定点域 （即顶点有了量化的 16.8 固定的点表示形式） 中的基元的边缘周围的正方形生成一个有效的外部不确定性区域。 此方形的维度均基于有效的外部不确定性区域大小： 对于像素 1/2，平方是 1 个像素宽度和高度，1/512 个像素，平方是 1/256 像素的宽度和高度。 绿色三角形表示给定的基元、 红色虚线表示上会被高估保守光栅化绑定、 solid 黑色方框表示沿基元的边缘，正方形，它是扫描和蓝色越过方格形终点的区域是外部不是确定性的区域：

![外部不确定性区域。](images/outercoverage.jpg)

### <a name="multisampling-interaction"></a>多级取样交互

而不考虑中的样本数**RenderTarget**/**DepthStencil**图面 (或是否*ForcedSampleCount*或未正在使用)，所有示例包含中的像素为单位光栅化保守光栅化。 无论它们处于基元或不会不测试各个示例的位置。

### <a name="samplemask-interaction"></a>SampleMask 交互

*SampleMask*光栅器状态适用保守光栅化有关的未启用时一样`InputCoverage`，但不会影响`InnerCoverage`(即它不用于启用和禁用到输入声明与`InnerCoverage`)。 这是因为`InnerCoverage`无关出是否屏蔽 MSAA 示例：0`InnerCoverage`像素不能保证完全涵盖的方式不会更新任何示例。

### <a name="depthstencil-test-interaction"></a>深度/模具测试交互

深度/模具测试继续保守光栅化像素相同的方式如同未启用保守光栅化时介绍的所有示例。

继续介绍的所有示例可能会导致深度外推法，有效，并且必须被限制到视区指定未启用保守光栅化时。 它类似于像素频率内插模式上的使用时**RenderTarget**示例计数大于 1，不过，对于保守光栅化，它是进入固定的函数深度的深度值可以推断出的测试。

早期深度消除深度外推的行为是未定义。 这是因为消除硬件一些早期深度不能正确地支持推算出的深度值。 但是，早期出现的情况下深度外推的精选行为是即使使用可支持的硬件有问题的深度中推断出的深度值。 可以解决该问题由夹紧到基元的正在光栅化和写入到的值的最小值和最大深度值的像素着色器输入的深度`oDepth`（像素着色器输出深度寄存器）。 实现所需禁用早期深度消除在此情况下，由于`oDepth`编写。

### <a name="helper-pixel-interaction"></a>帮助器像素交互

未启用保守光栅化时，帮助程序像素规则会应用方式相同。 此过程，必须报告包括帮助器像素为单位的所有像素`InputCoverage`中准确地指定`InputCoverage`交互部分。 因此完全不保修像素为单位报告 0 覆盖率。

### <a name="output-coverage-interaction"></a>输出覆盖率交互

输出覆盖率 (`oMask`) 对于行为保守光栅化像素，因为它涉及的所有示例使用未启用保守光栅化时，会执行。

### <a name="inputcoverage-interaction"></a>InputCoverage 交互

在保守光栅化模式下，像时未启用保守光栅化涵盖所有示例填充此输入的寄存器给定保守光栅化像素。 也就是说，应用现有的所有交互 (例如*SampleMask*应用)，和中的第一个 n 位`InputCoverage`从 LSB 将设置为 1 的保守光栅化像素，提供每像素 n 示例**RenderTarget**和/或**DepthStencil**缓冲区绑定在**输出合并器**，或 n 示例*ForcedSampleCount*。 其余位均为 0。

无论使用保守光栅化着色器中提供此输入了尽管保守光栅化更改其行为以只显示涉及的所有示例 （或未使用任何帮助器像素为单位）。

### <a name="innercoverage-interaction"></a>InnerCoverage 交互

此功能是必需的并且只会在第 3 层。 在运行时将会实现支持小于 3 层的层时，使用此模式下的着色器的着色器创建失败。

像素着色器具有 32 位标量整数可用的系统生成值： `InnerCoverage`。 这是具有位设置为 1。 对于 LSB 从 0 位字段给定保守光栅化像素，仅当该像素保证可完全在当前的基元。 必须将所有其他输入的注册位设置为 0，位 0 未设置，但未定义位 0 设置为 1 时 (实质上，必须正好为一个布尔值 false 的此位域表示可以为奇数 （即 0 位集） 的任何非零值 0，但事实的确如此)。 此输入用于在留住保守光栅化信息。 它会通知像素着色器的当前像素完全是否位于内部几何图形。

这必须考虑对齐分辨率大于或等于当前绘图操作的解析错误。 不能的假正值 (设置`InnerCoverage`位像素的分辨率大于或等于当前绘图操作的解析任何对齐错误未完全涵盖时)，但允许使用假负。 总之，实现必须未正确识别作为完整范围将不会与完整浮点指出顶点坐标光栅化程序中的像素。

如果硬件已使用完整浮点会全面涵盖的像素点坐标仅可省略如果它们相交的内部不确定性区域，必须为不大于亚像素网格的大小或 1/256 像素，固定的点域中的顶点。 换句话说，必须为完全涵盖标记完全在内部不确定性区域的内部边界内的像素为单位。 不确定性区域的内部边界图阐释了下面的粗体黑色虚线。 1/256 来自 16.8 固定点光栅器坐标表示形式，这可以更改如果光栅器精度发生更改。 此不确定性区域就足以应对对齐错误引起的光栅化程序在浮点到固定的点顶点坐标点顶点坐标的转换。

光栅化规则的交互中定义的相同 1/512 最小的不确定性区域要求此处也适用。

下图说明了通过扫描固定点域 （即顶点有了量化的 16.8 固定的点表示形式） 中的基元的边缘周围的正方形生成一个有效的内部不确定性区域。 此方形的维度均基于有效的内部不确定性区域大小： 1/256 像素的对于平方是 1/128 像素在宽度和高度。 绿色三角形表示给定的基元、 粗体黑色虚线表示的内部不确定性区域的边界、 solid 黑色方框表示沿基元的边缘，扫描的平方和的橙色越过方格形终点的区域是内部不是确定性的区域：

![内部不确定性 reqion。](images/innercoverage.jpg)

利用`InnerCoverage`不会影响像素保守是光栅化，即使用其中一种`InputCoverage`模式不会影响哪些像素进行光栅化启用保守光栅化模式。 因此，当`InnerCoverage`使用和像素着色器正在处理不完全受其值为 0，但像素着色器调用将具有示例已更新的几何图形的像素。 这是不同于何时`InputCoverage`为 0，这意味着，将更新任何示例。

此输入是与互斥`InputCoverage`： 不能使用两者。

访问`InnerCoverage`，它必须声明为一个组件中带一个像素着色器输入寄存器。 在声明上的插补模式必须是常量 （内插不适用）。

`InnerCoverage`位域不受影响的深度/模具测试，也不是它与*SampleMask*光栅器状态。

此输入是仅在保守光栅化模式下有效。 如果未启用保守光栅化，`InnerCoverage`产生未定义的值。

像素着色器调用所造成的帮助器像素，但否则未涵盖的基元，必须具有`InnerCoverage`注册设置为 0。

### <a name="attribute-interpolation-interaction"></a>属性内插交互

属性内插模式保持不变，并继续操作相同的方式，因为如果未启用保守光栅化，视区缩放和 fixed point 转换顶点使用的位置。 因为所有示例中光栅化像素被视为保守涵盖，它是有效的值可进行推测，类似于像素频率内插模式上的使用时**RenderTarget**示例计数更高版本比 1。 质心内插模式生成相应的非质心内插模式; 与相同的结果质心的概念是在此方案 – 其中示例覆盖率是仅为完整或 0 中没有意义。

传统型光栅化允许退化的三角形以产生像素着色器的调用，因此，退化三角形必须使用分配给所有内插值顶点 0 的值。

### <a name="clipping-interaction"></a>剪辑交互

当保守光栅化模式已启用和禁用深度剪辑 (当*DepthClipEnable*光栅器状态设置为 FALSE)，可能会在片段的超出范围的基元属性内插的方差0 < = z < = w 范围，具体取决于实现： 从点其中基元相交相关平面 （近或远），或属性内插表现为禁用保守光栅化模式下时使用任一的常数值。 但是，深度值行为而不考虑保守光栅化模式相同，即深度范围超出范围的基元必须仍为其赋予值最接近的视区深度范围限制。 属性内插行为在 0 < = z < = w 范围必须保持不变。

### <a name="clip-distance-interaction"></a>剪辑距离交互

保守光栅化模式已启用，并且对于行为时，剪辑距离是无效的保守光栅化像素，因为它涉及的所有示例使用未启用保守光栅化时，会执行。

请注意，保守光栅化可能会导致外推的 W 顶点坐标，这可能会导致 W < = 0。 这可能导致每像素剪辑距离实现，以便对剪辑距离的角度来看划分无效 W 值执行操作。 剪辑距离实现必须防止出现调用其中顶点坐标的像素为单位的光栅化 W < = 0 （例如，由于在保守光栅化模式下外推法）。

### <a name="target-independent-rasterization-interaction"></a>目标独立光栅化交互

传统型光栅化模式是使用目标独立光栅化 (TIR) 兼容。 TIR 适用规则和限制，行为的保守光栅化像素像涵盖所有示例。

### <a name="ia-primitive-topology-interaction"></a>IA 原型拓扑交互

没有为线条或点基元定义传统型光栅化。 因此，指定点或行的基元拓扑生成未定义的行为，如果它们在启用保守光栅化后送入光栅器单元。

调试层验证会验证应用程序不使用这些基元的拓扑。

### <a name="query-interaction"></a>查询交互

有关保守光栅化像素，查询的行为与它们时介绍的所有示例时，不启用保守光栅化。 例如，对于保守光栅化像素，D3D12\_查询\_类型\_封闭和 D3D12\_查询\_类型\_管道\_统计信息 (从[ **D3D12\_查询\_类型**](/windows/desktop/api/D3D12/ne-d3d12-d3d12_query_type)) 必须表现得就像时介绍的所有示例时，不启用保守光栅化。

像素着色器调用将为递增每个光栅化像素保守保守光栅化模式。

### <a name="cull-state-interaction"></a>剔除状态交互

所有剔除状态是在保守光栅化模式下有效的未启用保守光栅化时，请遵循相同的规则。

时比较保守光栅化之间到自身或在没有保守光栅化启用的解决方法，则可能会，某些基元可能具有不匹配的 facedness （即一个后面向其他前端面向）。 应用程序可以通过使用 D3D12 来避免这种不确定性\_挑选\_模式\_NONE (从[ **D3D12\_挑选\_模式**](/windows/desktop/api/D3D12/ne-d3d12-d3d12_cull_mode))，而不使用`IsFrontFace`系统生成的值。

### <a name="isfrontface-interaction"></a>IsFrontFace 交互

`IsFrontFace`系统生成的值是有效使用处于保守光栅化模式，并且未启用保守光栅化时定义的行为如下所示。

### <a name="fill-modes-interaction"></a>填充模式交互

唯一有效[ **D3D12\_填充\_模式**](/windows/desktop/api/D3D12/ne-d3d12-d3d12_fill_mode)保守光栅化是 D3D12\_填充\_坚实、 任何其他填充模式是一个无效光栅器状态的参数。

这是因为 D3D12 功能规范指定线框的填充模式应将三角形的边转换为行和遵循行光栅化规则和保守行光栅化行为未定义。

## <a name="implementation-details"></a>实现详细信息

在 Direct3D 12 中受支持的光栅化的类型有时被称为"会被高估保守光栅化"。 此外，还有"低估保守光栅化"，这意味着只有完全受呈现基元的像素为单位进行光栅化的概念。 在留住的保守光栅化信息已通过输入的覆盖率数据，使用像素着色器，仅会被高估保守光栅化可作为光栅化模式。

如果基元类型的任何部分重叠像素，则该像素视为涵盖，随后光栅化。 如果的边缘或角部基元降沿边缘或角像素，"左上方规则"的应用程序是特定于实现的。 但是，对于支持退化三角形的实现，边缘或边角沿一个退化三角形必须包含至少一个像素。

传统型光栅化实现在不同硬件上，而异，并产生误报，这意味着，他们可以正确决定介绍了像素为单位。 这可能由于特定于实现的详细信息，如基元增长或对齐在光栅化中使用的定点的顶点坐标中固有的错误。 误报 （相对于固定的顶点坐标） 是有效的原因是因为一定量的假正值均需要使用以允许实现来完成后已对齐顶点 （即顶点坐标已针对覆盖率评估已从浮点数到定点 16.8 光栅化程序中使用），但遵循覆盖率生成的原始浮动点顶点坐标。

传统型光栅化实现不会生成非退化后对齐基元的相对于浮点的顶点坐标的假负： 如果基元类型的任何部分重叠的像素，任何部分，则该像素是光栅化。

三角形的退化 （重复索引索引缓冲区中或在 3D 共线），或成为退化定点转换 （光栅化程序中的共线顶点），可能会或可能不剔除; 之后这两个有效的行为。 退化的三角形，必须考虑重新出现，因此如果应用程序需要特定的行为，它可以使用背面或用于前端的面向的测试。 退化的三角形使用分配给所有内插值顶点 0 的值。

有三个层的硬件支持，除了硬件不支持此功能的可能性。

-   第 1 层强制实施最大的 1/2 像素的不确定性区域，不支持管理单元后 degenerates。 这是适用于平铺的呈现、 纹理地图集、 浅映射生成和子像素卷影映射。
-   第 2 层可最大的不确定性区域减少为 1/256 和需要后管理单元不剔除 degenerates。 此层可帮助基于 CPU 的算法 （如 voxelization) 加速。
-   第 3 层维护的最大的 1/256 不确定性区域，并添加了对内部输入覆盖率支持。 内部输入的覆盖范围添加新值`SV_InnerCoverage`到高级别着色语言 (HLSL)。 这是可以指定在向像素着色器中，输入一个 32 位标量整数，表示在留住的保守光栅化信息 （即，是否像素保证-到-是-中完整介绍）。 此层可帮助消除的阻挡物。

## <a name="api-summary"></a>API 摘要

以下方法、 结构、 枚举和帮助程序类引用保守光栅化：

-   [**D3D12\_光栅器\_DESC** ](/windows/desktop/api/D3D12/ns-d3d12-d3d12_rasterizer_desc) ： 保存光栅器说明的结构。
-   [**D3D12\_保守\_光栅化\_模式**](/windows/desktop/api/D3D12/ne-d3d12-d3d12_conservative_rasterization_mode) : （on 或 off） 模式的枚举值。
-   [**D3D12\_功能\_数据\_D3D12\_选项**](/windows/desktop/api/D3D12/ns-d3d12-d3d12_feature_data_d3d12_options) ： 存放的支持层结构。
-   [**D3D12\_保守\_光栅化\_层**](/windows/desktop/api/D3D12/ne-d3d12-d3d12_conservative_rasterization_tier) ： 每个层的硬件支持的枚举值。
-   [**CheckFeatureSupport** ](/windows/desktop/api/D3D12/nf-d3d12-id3d12device-checkfeaturesupport) ： 方法访问受支持的功能。
-   [**CD3DX12\_光栅器\_DESC** ](cd3dx12-rasterizer-desc.md) ： 帮助器类，用于创建光栅器说明。

## <a name="related-topics"></a>相关主题

<dl> <dt>

[DirectX 高级学习视频教程：传统型光栅化](https://www.youtube.com/watch?v=zL0oSY_YmDY)
</dt> <dt>

[光栅器有序视图](rasterizer-order-views.md)
</dt> <dt>

[呈现](rendering.md)
</dt> </dl>

 

 




